<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.fsun.dao.report.mapper.ContrastUseSoMapper" >

  <sql id="conditions">
  	<where>  	 		
  		<if test="keywords != null and keywords != ''">
  			and (o.order_no like concat(concat('%',#{keywords}),'%')
  				or o.i_name like concat(concat('%',#{keywords}),'%')
  				or o.mobile like concat(concat('%',#{keywords}),'%')
  			)
  		</if>
  		
  		<if test="carrierId != null and carrierId != ''">
  			and o.carrier_id = #{carrierId}
  		</if>
  		  	  	  		 	 		 		
  		<if test="orderNo != null and orderNo != ''">
  			and o.order_no = #{orderNo}
  		</if>
  		
  		<if test="fromShopId != null and fromShopId != ''">
  			and o.from_shop_id = #{fromShopId}
  		</if>
  		
  		<if test="orderType != null and orderType != ''">
			and o.order_type = #{orderType}
		</if>
  		
  		<if test="orderStatus != null and orderStatus != ''">
  			and o.order_status = #{orderStatus}
  		</if>
  		
  		<if test="orderMode != null and orderMode != ''">
  			and o.order_mode = #{orderMode}
  		</if>
  		
  		<if test="customerCode != null and customerCode != ''">
  			and o.onsignee_id = #{customerCode}
  		</if> 
  		
  		<if test="startTime != null">
			and o.delivery_time<![CDATA[ >= ]]> #{startTime,jdbcType=TIMESTAMP}
		</if>
		<if test="endTime != null">
			and o.delivery_time <![CDATA[ <= ]]>#{endTime,jdbcType=TIMESTAMP}
		</if>
  		
	</where>
  </sql>

  <select id="selectListMap" resultType="java.util.Map" 
  	parameterType="com.fsun.domain.report.ContrastUseSoCondition" >    
	SELECT
		g.goods_name AS goods_name,
		g.sku AS sku,
		g.price AS price,
		getValueForBasCodes(g.unit,'UnitCode') as unit,
		g.shipped_qty AS shipped_qty,		
		g.total_price AS total_price,		
		
		o.onsignee_id AS customer_code,
		o.onsign_name AS onsign_name,
		o.carrier_name as carrier_name,
		o.order_no AS order_no,
		o.order_type AS order_type,
		o.order_status AS order_status,		
		o.order_mode AS order_mode,
		o.from_shop_name AS from_shop_name,
		o.order_price AS order_price,		
		o.i_name AS i_name,
		o.created_name AS created_name,
		o.delivery_time AS delivery_time,
		o.mobile as mobile,
		o.memo AS memo
	FROM doc_order_header o 
	LEFT JOIN doc_order_details g ON g.order_no = o.order_no	
	<include refid="conditions" />
  </select>
  
  <select id="findFooter" resultType="java.util.Map" 
  	parameterType="com.fsun.domain.report.ContrastUseSoCondition" >    
	SELECT 
		sum(o.order_price) as order_price
    FROM doc_order_header o
    	<include refid="conditions" />
  </select>
  
  
  <select id="export" resultType="java.util.Map" 
  	parameterType="com.fsun.domain.report.ContrastUseSoCondition" >    
	SELECT
		g.goods_name AS goods_name,
		g.sku AS sku,
		g.price AS price,
		getValueForBasCodes(g.unit,'UnitCode') as unit,
		g.shipped_qty AS shipped_qty,			
		g.total_price AS total_price,
		
		o.onsignee_id AS customer_code,
		o.onsign_name AS onsign_name,
		o.carrier_name as carrier_name,
		o.order_no AS order_no,
		getValueForBasCodes(o.order_type,'DocOrderType') AS order_type,
		getValueForBasCodes(o.order_status,'DocOrderStatus') AS order_status,		
		getValueForBasCodes(o.order_mode,'DocOrderMode') AS order_mode,
		o.from_shop_name AS from_shop_name,
		o.order_price AS order_price,		
		o.i_name AS i_name,
		o.created_name AS created_name,
		o.delivery_time AS delivery_time,
		o.mobile as mobile,
		o.memo AS memo
	FROM doc_order_header o 
	LEFT JOIN doc_order_details g ON g.order_no = o.order_no	
	<include refid="conditions" />
	ORDER BY o.order_no DESC, g.sku ASC
  </select>
  
</mapper>